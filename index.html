<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cosmos Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #333; color: white; }
  tr:nth-child(even) { background: #f0f0f0; }
  tr.offline { background: #ffe0e0; }
</style>
</head>
<body>

<h1>Cosmos Chains Dashboard</h1>
<table>
  <thead>
    <tr>
      <th>Chain</th>
      <th>Latest Block</th>
      <th>Block Time</th>
      <th>Validators</th>
      <th>Active Proposals</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="chainTable">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>

<script>
const chains = [
   { key:"cosmoshub", label:"Cosmos Hub", api:"https://rest.cosmos.directory/cosmoshub" },
  { key:"osmosis",   label:"Osmosis",    api:"https://rest.cosmos.directory/osmosis" },
  { key:"akash",     label:"Akash",      api:"https://rest.cosmos.directory/akash" },
   { key:"juno",      label:"Juno",       api:"https://rest.cosmos.directory/juno" },
   { key:"stargaze",  label:"Stargaze",   api:"https://rest.cosmos.directory/stargaze" },
  { key:'chihuahua', label:'Chihuahua', api:"https://rest.cosmos.directory/chihuahua" },
  { key:'nolus', label:'Nolus Protocol', api:'https://nolus-api.polkachu.com' },
  { key:'dymension', label:'Dymension', api:'https://dymension-mainnet-rest.public.blastapi.io' }
];

async function fetchJSON(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error(`HTTP error ${res.status}`);
  return res.json();
}

function fmtSecs(secs){
  if(secs < 60) return secs.toFixed(1) + 's';
  if(secs < 3600) return (secs/60).toFixed(1) + 'm';
  if(secs < 86400) return (secs/3600).toFixed(1) + 'h';
  return (secs/86400).toFixed(1) + 'd';
}

async function fetchChainSummary(chain){
  try{
    const latest = await fetchJSON(`${chain.api}/cosmos/base/tendermint/v1beta1/blocks/latest`);
    const height = Number(latest.block.header.height);
    const t2 = new Date(latest.block.header.time).getTime();

    let blockTime = '-';
    if(height > 1){
      const prev = await fetchJSON(`${chain.api}/cosmos/base/tendermint/v1beta1/blocks/${height-1}`);
      const t1 = new Date(prev.block.header.time).getTime();
      blockTime = fmtSecs((t2 - t1)/1000);
    }

    const v = await fetchJSON(`${chain.api}/cosmos/staking/v1beta1/validators?status=BOND_STATUS_BONDED&pagination.limit=500`);
    const valCount = (v.validators || []).length;

    let actProps = '-';
    try{
      const gov = await fetchJSON(`${chain.api}/cosmos/gov/v1beta1/proposals?proposal_status=2`);
      actProps = (gov.proposals || []).length;
    }catch{
      actProps = '-';
    }

    return { ok:true, name: chain.label, latestBlock: height, blockTime, validators: valCount, proposals: actProps, status: 'live' };

  }catch{
    return { ok:false, name: chain.label, latestBlock: '-', blockTime: '-', validators: '-', proposals: '-', status: 'offline' };
  }
}

async function updateDashboard(){
  const table = document.getElementById('chainTable');
  table.innerHTML = '';
  for(const chain of chains){
    const data = await fetchChainSummary(chain);
    const row = document.createElement('tr');
    if(!data.ok) row.classList.add('offline');
    row.innerHTML = `
      <td>${data.name}</td>
      <td>${data.latestBlock}</td>
      <td>${data.blockTime}</td>
      <td>${data.validators}</td>
      <td>${data.proposals}</td>
      <td>${data.status}</td>
    `;
    table.appendChild(row);
  }
}

updateDashboard();
setInterval(updateDashboard, 60000);
</script>

</body>
</html>
