<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MINI Cosmos Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; }
  h1 { text-align: center; }
  .stats { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; }
  .stat-box { background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  table { width: 100%; border-collapse: collapse; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #333; color: white; }
  tr:nth-child(even) { background: #f0f0f0; }
  tr.offline { background: #ffe0e0; }
</style>
</head>
<body>

<h1>MINI Cosmos Chains Dashboard</h1>

<div class="stats">
  <div class="stat-box">
    <strong>Fear & Greed Index:</strong> <span id="fngValue">Loading...</span>
  </div>
  <div class="stat-box">
    <strong>Total Market Cap:</strong> <span id="marketCap">Loading...</span>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>Chain</th>
      <th>Latest Block</th>
      <th>Block Time</th>
      <th>Validators</th>
      <th>Active Proposals</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="chainTable">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>

<script>
const chains = [
  { key:"cosmoshub", label:"Cosmos Hub", api:"https://rest.cosmos.directory/cosmoshub" },
  { key:"osmosis",   label:"Osmosis",    api:"https://rest.cosmos.directory/osmosis" },
  { key:"akash",     label:"Akash",      api:"https://rest.cosmos.directory/akash" },
  { key:"juno",      label:"Juno",       api:"https://rest.cosmos.directory/juno" },
  { key:"stargaze",  label:"Stargaze",   api:"https://rest.cosmos.directory/stargaze" },
  { key:"chihuahua", label:"Chihuahua",  api:"https://rest.cosmos.directory/chihuahua" },
  { key:"nolus",     label:"Nolus Protocol", api:"https://nolus-api.polkachu.com" },
  { key:"dymension", label:"Dymension",  api:"https://dymension-mainnet-rest.public.blastapi.io" }
];

async function fetchJSON(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error(`HTTP error ${res.status}`);
  return res.json();
}

function fmtSecs(secs){
  if(secs < 60) return secs.toFixed(1) + 's';
  if(secs < 3600) return (secs/60).toFixed(1) + 'm';
  if(secs < 86400) return (secs/3600).toFixed(1) + 'h';
  return (secs/86400).toFixed(1) + 'd';
}

async function fetchChainSummary(chain){
  try{
    const latest = await fetchJSON(`${chain.api}/cosmos/base/tendermint/v1beta1/blocks/latest`);
    const height = Number(latest.block.header.height);
    const t2 = new Date(latest.block.header.time).getTime();

    let blockTime = '-';
    if(height > 1){
      const prev = await fetchJSON(`${chain.api}/cosmos/base/tendermint/v1beta1/blocks/${height-1}`);
      const t1 = new Date(prev.block.header.time).getTime();
      blockTime = fmtSecs((t2 - t1)/1000);
    }

    const v = await fetchJSON(`${chain.api}/cosmos/staking/v1beta1/validators?status=BOND_STATUS_BONDED&pagination.limit=500`);
    const valCount = (v.validators || []).length;

    let actProps = '-';
    try{
      const gov = await fetchJSON(`${chain.api}/cosmos/gov/v1beta1/proposals?proposal_status=2`);
      actProps = (gov.proposals || []).length;
    }catch{
      actProps = '-';
    }

    return { ok:true, name: chain.label, latestBlock: height, blockTime, validators: valCount, proposals: actProps, status: 'live' };

  }catch{
    return { ok:false, name: chain.label, latestBlock: '-', blockTime: '-', validators: '-', proposals: '-', status: 'offline' };
  }
}

async function updateDashboard(){
  const table = document.getElementById('chainTable');
  table.innerHTML = '';
  for(const chain of chains){
    const data = await fetchChainSummary(chain);
    const row = document.createElement('tr');
    if(!data.ok) row.classList.add('offline');
    row.innerHTML = `
      <td>${data.name}</td>
      <td>${data.latestBlock}</td>
      <td>${data.blockTime}</td>
      <td>${data.validators}</td>
      <td>${data.proposals}</td>
      <td>${data.status}</td>
    `;
    table.appendChild(row);
  }
}

// Fetch Fear & Greed Index
async function updateFearGreed(){
  try {
    const data = await fetchJSON('https://api.alternative.me/fng/');
    const value = data.data[0].value;
    const classification = data.data[0].value_classification;
    document.getElementById('fngValue').innerText = `${value} (${classification})`;
  } catch {
    document.getElementById('fngValue').innerText = 'Error';
  }
}

// Fetch Total Market Cap (USD)
async function updateMarketCap(){
  try {
    const data = await fetchJSON('https://api.coingecko.com/api/v3/global');
    const cap = data.data.total_market_cap.usd;
    document.getElementById('marketCap').innerText = `$${cap.toLocaleString()}`;
  } catch {
    document.getElementById('marketCap').innerText = 'Error';
  }
}

function refreshAll(){
  updateDashboard();
  updateFearGreed();
  updateMarketCap();
}

refreshAll();
setInterval(refreshAll, 60000);
</script>

</body>
</html>
